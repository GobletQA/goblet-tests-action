# action.yml
name: 'Goblet Tests'
description: 'Run Goblet tests in a github action'
inputs:
  goblet-test-context:
    required: false
    description: 'Path or name to the tests to run. Runs all tests if not defined'
  git-token:
    required: true
    description: 'Github Token with write access to the repository'
  goblet-token:
    required: true
    description: 'CI token from the goblet platform'
  report-name:
    required: false
    default: '<timestamp>-goblet-report'
    description: 'Name of the report file generated from the test results'
  pre-goblet:
    required: false
    default: ''
    description: 'Commands to run prior to running the Goblet tests'
  post-goblet:
    required: false
    default: ''
    description: 'Commands to run after the Goblet tests have finished executing'
  alt-repo:
    required: false
    description: 'Alternative github repository that contains the tests to be run.'
  alt-branch:
    required: false
    description: 'Name of the branch to use for the alt repository.'
  alt-user:
    required: false
    description: 'Github user name or organization with write access to the alt repository.'
  alt-email:
    required: false
    description: 'Email of user with write access to the alt repository.'
  alt-token:
    required: false
    description: 'Github Token with write access to the alt repository.'
  test-retry:
    required: false
    description: 'Number of times a failed test should be retried'
  test-tracing:
    required: false
    description: 'Enabled test tracing via playwright.'
  test-record:
    required: false
    description: 'Enabled browser video recording via playwright.'
  test-screenshot:
    required: false
    description: 'Enabled browser image snapshots for failed tests. Ignored if "test-tracing" is true'

outputs:
  result:
    description: 'Result of the executed Goblet tests, one of `pass` or `fail`'
  report-path:
    description: 'Path to the generated test report from the executed tests'
  artifacts-path:
    description: 'Path to the generated artifacts from the executed tests'
  error:
    description: 'Error message output when the action fails for a reason other than test execution'

runs:
  using: 'docker'
  image: 'Dockerfile'
  args:
    - ${{ inputs.goblet-test-context }}
    - ${{ inputs.git-token }}
    - ${{ inputs.goblet-token }} #3
    - ${{ inputs.report-name }}
    - ${{ inputs.pre-goblet }}
    - ${{ inputs.post-goblet }} #6
    - ${{ inputs.alt-repo }}
    - ${{ inputs.alt-branch }}
    - ${{ inputs.alt-user }} #9
    - ${{ inputs.alt-email }}
    - ${{ inputs.alt-token }}
    - ${{ inputs.test-retry }} # 12
    - ${{ inputs.test-tracing }}
    - ${{ inputs.test-screenshot }}
    - ${{ inputs.test-record }} #15
    